<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>TrueTrend AI ‚Äî Learn money. Earn money. Own money.</title>
<meta name="description" content="TrueTrend AI reads any chart, explains the why, and tells you what‚Äôs changing‚Äîno Telegrams, WhatsApp, or gurus needed."/>
<link rel="preconnect" href="https://query1.finance.yahoo.com" crossorigin>
<style>
  :root{
    --bg:#070b14;--ink:#ecf1ff;--mut:#97a5c7;--card:#0d1324;--line:#1a2340;
    --acc:#22c55e;--acc2:#7c5cff;--chip:#111a33;--glow:0 10px 24px rgba(124,92,255,.25)
  }
  *{box-sizing:border-box} html,body{margin:0;background:linear-gradient(180deg,#070b14 0%,#0a1130 100%);color:var(--ink);
  font:16px/1.45 Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  a{color:#9cc1ff;text-decoration:none}
  .wrap{max-width:1180px;margin:0 auto;padding:22px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:10px}
  .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(45deg,var(--acc2),#36d399);box-shadow:0 0 18px #7c5cff}
  nav a{margin:0 10px;color:var(--mut)}
  .btn{background:var(--acc);color:#062613;border:0;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
  .btn.ghost{background:#121a33;color:#cfe0ff;border:1px solid var(--line)}
  .btn.purple{background:var(--acc2);color:#0a0720;box-shadow:var(--glow)}
  .tag{display:inline-block;background:#0c1530;border:1px solid var(--line);padding:6px 10px;border-radius:999px;color:#cde1ff;margin:4px 6px 0 0;font-size:.86rem}
  .grid{display:grid;gap:20px;grid-template-columns:1.05fr 1fr;margin-top:18px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;position:relative}
  h1{font-size:40px;line-height:1.07;margin:8px 0 6px}
  .sub{color:var(--mut)}
  input,select,textarea{background:#0b1430;border:1px solid var(--line);color:var(--ink);border-radius:12px;padding:11px 12px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .pill{background:#0f1a3a;border:1px solid var(--line);padding:6px 10px;border-radius:999px}
  .mut{color:var(--mut)} .mono{font-family:ui-monospace,Consolas,Menlo,monospace}
  .divider{height:1px;background:var(--line);margin:16px 0}
  .lockable{position:relative}
  .lockOverlay{position:absolute;inset:0;background:rgba(6,10,20,.72);display:flex;align-items:center;justify-content:center;border-radius:16px}
  .lockInner{background:#0b1222;border:1px solid var(--line);padding:14px;border-radius:12px;text-align:center}
  .modal{position:fixed;inset:0;background:rgba(2,4,10,.58);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;padding:18px;z-index:50}
  .sheet{max-width:900px;width:100%;background:#0d1326;border:1px solid var(--line);border-radius:16px;padding:16px}
  canvas{max-width:100%} table{width:100%;border-collapse:collapse} th,td{padding:6px;border-bottom:1px solid var(--line)}
  footer{margin:40px 0 16px;color:var(--mut);text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand"><span class="dot"></span><strong>TrueTrend AI</strong><span id="planBadge" class="tag">Checking plan‚Ä¶</span></div>
    <nav><a href="#strategies">Strategies</a><a href="#pricing">Pricing</a><a href="#" id="openGuide">How-to</a></nav>
    <div><a class="btn purple" href="#pricing">Start 3-Day Free</a></div>
  </header>

  <section class="grid">
    <div class="card">
      <h1>Learn money. Earn money. Own money.</h1>
      <p class="sub">Read <b>any chart</b>, get buy/sell with reasons, track wins & losses‚Äî<b>no Telegrams, WhatsApp, or gurus needed</b>.</p>
      <div class="divider"></div>
      <div class="mut" style="margin:4px 0 6px">Works with charting:</div>
      <div>
        <span class="tag">TradingView</span><span class="tag">Thinkorswim</span><span class="tag">Webull</span>
        <span class="tag">MooMoo</span><span class="tag">MT4/5</span><span class="tag">TradeStation</span><span class="tag">TradeLocker</span>
      </div>
      <div class="mut" style="margin:10px 0 6px">And brokers/exchanges:</div>
      <div><span class="tag">Schwab</span><span class="tag">Fidelity</span><span class="tag">OANDA (FX)</span><span class="tag">Binance</span></div>
      <div class="divider"></div>
      <div class="row"><a class="btn" href="#pricing">Try 3-Day Free</a><button class="btn ghost" id="openStrategies">See Strategies & How-to</button></div>
    </div>

    <div class="card lockable" id="proPanel">
      <div class="row" style="justify-content:space-between"><h3 style="margin:0">Analyzer (Pro/Lifetime)</h3><div class="pill">Over-trading: <b id="otLabel">Cool</b></div></div>
      <div class="row" style="margin-top:10px">
        <input id="symbol" placeholder="Ticker e.g. NVDA, EURUSD, BTCUSD" style="flex:1" aria-label="Symbol"/>
        <select id="timeframe" aria-label="Timeframe">
          <option>15m</option><option>1h</option><option>4h</option><option selected>Daily</option><option>Weekly</option>
        </select>
        <select id="strategy" aria-label="Strategy">
          <option value="trendline">Trendline (short-term)</option>
          <option value="cross">Crossing EMAs (swing)</option>
          <option value="rsiReversal">RSI Reversal (short-term)</option>
          <option value="breakout">Range Breakout (any)</option>
        </select>
        <button class="btn" id="run">Analyze</button>
      </div>
      <pre id="answer" class="mono" style="margin-top:10px;white-space:pre-wrap"></pre>
      <div id="voiceRow" class="row" style="margin-top:6px;display:none"><button class="btn ghost" id="speakBtn">üîä Read it</button><span class="mut">Friendlier male voice</span></div>
    </div>
  </section>

  <section class="grid" style="margin-top:18px">
    <div class="card" id="journalCard">
      <h3>Trade Journal & Equity Curve</h3>
      <p class="mut">All plans get journaling. Log entries/exits, why you won or lost; we‚Äôll draw your equity curve.</p>
      <div class="row" style="gap:8px;margin:6px 0">
        <input id="jSym" placeholder="Symbol" style="width:120px">
        <input id="jEntry" type="number" step="0.0001" placeholder="Entry">
        <input id="jExit" type="number" step="0.0001" placeholder="Exit">
        <select id="jSide"><option>BUY</option><option>SELL</option></select>
        <input id="jNotes" placeholder="Why win/lose?">
        <button class="btn" id="addJ">Add</button>
      </div>
      <canvas id="equity" height="120"></canvas>
      <div class="divider"></div>
      <table id="jTable"><thead><tr style="color:#c6d6ff"><th align="left">Date</th><th align="left">Symbol</th><th>Side</th><th>Entry</th><th>Exit</th><th>P/L</th><th align="left">Notes</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="card">
      <h3>Voice lookup (Pro/Lifetime)</h3>
      <p class="mut">Ask TrueTrend for a ticker and it reads the bias, confidence, RSI, and levels.</p>
      <div class="row"><input id="voiceSym" placeholder="AAPL, NVDA, EURUSD"/><button class="btn" id="voiceAnalyze">Get voice</button></div>
      <pre id="voiceOut" class="mono" style="margin-top:8px;white-space:pre-wrap"></pre>
    </div>
  </section>

  <section id="pricing" class="card" style="margin-top:24px">
    <h3>Pricing</h3>
    <div class="row" style="flex-wrap:wrap;gap:16px">
      <div class="card" style="min-width:250px">
        <h4>Basic ‚Äî $59.99/mo</h4>
        <ul class="mut"><li>Reads any chart you open</li><li>Journal + Equity Curve</li><li>Over-trading guard</li></ul>
        <a class="btn" href="https://buy.stripe.com/fZueVd0nPgU4dzvfkW38401">Start 3-Day Free</a>
      </div>
      <div class="card" style="min-width:250px;border-color:#7c5cff;box-shadow:var(--glow)">
        <h4>Pro ‚Äî $99.99/mo</h4>
        <ul class="mut"><li>Everything in Basic</li><li>Analyzer + Strategy Builder</li><li>Voice + Alexa directions</li></ul>
        <a class="btn purple" href="https://buy.stripe.com/3cI7sLfiJ33efHDdcO38400">Start 3-Day Free</a>
      </div>
      <div class="card" style="min-width:250px;border-color:#22c55e">
        <h4>Lifetime ‚Äî $999 one-time</h4>
        <ul class="mut"><li>All Pro features forever</li><li>Future strategy packs included</li></ul>
        <a class="btn" href="https://buy.stripe.com/bJe00jfiJ7ju3YVdcO38406">Start 3-Day Free</a>
      </div>
    </div>
  </section>

  <footer>¬© <span id="year"></span> TrueTrend AI</footer>
</div>

<!-- Strategies / How-to -->
<div class="modal" id="guide">
  <div class="sheet">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 id="strategies" style="margin:0">Strategies & How-to</h3>
      <button class="btn ghost" id="closeGuide">Close</button>
    </div>
    <div class="divider"></div>
    <h4>Built-in strategies</h4>
    <ul class="mut">
      <li><b>Trendline (short-term):</b> EMA slope proxy + pullback confirm.</li>
      <li><b>Crossing EMAs (swing):</b> EMA-9 over/under EMA-50 + momentum thrust.</li>
      <li><b>RSI Reversal (short-term):</b> RSI(14) crosses 30/70 with momentum.</li>
      <li><b>Range Breakout (any):</b> break of recent high/low with retest.</li>
      <li><b>Multi-TF filter:</b> optional higher-timeframe slope check.</li>
    </ul>
    <div class="divider"></div>
    <h4>Alexa voice hookup (Pro/Lifetime)</h4>
    <ol class="mut">
      <li>Enable Voice in TrueTrend settings.</li>
      <li>In Alexa app, add a Custom Skill: invocation ‚ÄúTrueTrend‚Äù.</li>
      <li>Say: ‚ÄúAlexa, ask TrueTrend if NVDA is a buy on daily.‚Äù</li>
      <li>We read bias, confidence, RSI, and key levels.</li>
    </ol>
    <div class="divider"></div>
    <h4>How to analyze</h4>
    <ol class="mut"><li>Enter <b>Ticker</b> ‚Üí pick <b>Timeframe</b> ‚Üí choose <b>Strategy</b>.</li><li>Click <b>Analyze</b>. Pro/Lifetime unlocks voice + enhanced signals.</li><li>Log the trade in <b>Journal</b> to build your equity curve.</li></ol>
  </div>
</div>

<script>
/* ===== helpers ===== */
const $=s=>document.querySelector(s); const $$=s=>document.querySelectorAll(s);
const num=(n,d=2)=> (n==null||isNaN(n))?'-':Number(n).toFixed(d);

/* ===== plan gate (defaults to Basic if backend absent) ===== */
async function getPlan(){
  try{const r=await fetch('/api/entitlements/whoami',{credentials:'include'}); if(!r.ok) throw 0; const j=await r.json(); return j.plan||'basic';}
  catch{return 'basic'}
}
async function gate(){
  const p=await getPlan();
  $('#planBadge').textContent = p==='pro'?'Pro':p==='lifetime'?'Lifetime':p==='family'?'Family':'Basic';
  const pro = (p==='pro'||p==='lifetime'||p==='family');
  if(!pro){
    if(!$('#proPanel').querySelector('.lockOverlay')){
      $('#proPanel').insertAdjacentHTML('beforeend','<div class="lockOverlay"><div class="lockInner"><b>Pro/Lifetime required</b><div style="margin-top:8px"><a class="btn purple" href="#pricing">Start 3-Day Free</a></div></div></div>');
    }
  } else {
    $('#voiceRow').style.display='flex';
  }
}
gate();

/* ===== modal ===== */
$('#openGuide').onclick=$('#openStrategies').onclick=()=>{$('#guide').style.display='flex'};
$('#closeGuide').onclick=()=>{$('#guide').style.display='none'};

/* ===== over-trading guard ===== */
const clicks=[]; function markAnalyze(){const now=Date.now();clicks.push(now);while(clicks[0]<now-60*60*1e3)clicks.shift();$('#otLabel').textContent=(clicks.filter(t=>t>now-15*60*1e3).length>10||clicks.length>25)?'Slow down':'Cool'}

/* ===== analyzer (server API, lean) ===== */
document.addEventListener('DOMContentLoaded',()=>{
  $('#run').addEventListener('click',async ()=>{
    markAnalyze();
    const symbol=($('#symbol').value||'NVDA').trim(), timeframe=$('#timeframe').value, strategy=$('#strategy').value;
    $('#answer').textContent=`Analyzing ${symbol} (${timeframe})‚Ä¶`;
    try{
      const r=await fetch('/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({symbol,timeframe, strategy})});
      const j=await r.json(); if(j.error) throw new Error(j.message||'Server error');
      const lines=[]; lines.push(`Symbol: ${symbol} (${timeframe})`);
      lines.push(`Price: ${num(j.quote.c)}   High: ${num(j.quote.h)}   Low: ${num(j.quote.l)}`);
      lines.push(`Signal: ${j.signal.action}   Confidence: ${Math.round(j.signal.confidence)}%`);
      if(j.targets?.entry) lines.push(`Entry: ${num(j.targets.entry)}   Stop: ${num(j.targets.stop)}   TP: ${num(j.targets.tp)}`);
      lines.push('‚Äî Reasons ‚Äî'); (j.signal.reasons||[]).forEach(r=>lines.push('‚Ä¢ '+r));
      $('#answer').textContent=lines.join('\n');

      if('Notification' in window){
        if(Notification.permission==='default') await Notification.requestPermission();
        if(Notification.permission==='granted'){ new Notification(`TrueTrend: ${j.signal.action}`, { body:`${symbol} ${timeframe} ¬∑ ${Math.round(j.signal.confidence)}%` });}
      }
      $('#speakBtn').onclick=()=> speak(j.voiceText || lines.join('. '));
    }catch(e){
      $('#answer').textContent='Error: '+(e.message||'Failed to analyze.');
    }
  }, {passive:true});

  $('#voiceAnalyze').addEventListener('click', async ()=>{
    const s=($('#voiceSym').value||'AAPL').trim();
    $('#voiceOut').textContent='Fetching voice for '+s+'‚Ä¶';
    try{
      const r=await fetch('/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({symbol:s,timeframe:'Daily',strategy:'trendline'})});
      const j=await r.json();
      $('#voiceOut').textContent=j.voiceText||'‚Äî';
      if($('#voiceRow').style.display==='flex') speak(j.voiceText);
    }catch(e){ $('#voiceOut').textContent='Error: '+(e.message||'Failed'); }
  }, {passive:true});
});

/* ===== voice (friendlier male) loaded lazily ===== */
function pickMaleVoice(){const vs=speechSynthesis.getVoices();const pref=[/Daniel/i,/Alex/i,/UK English Male/i,/Google UK English Male/i,/Male/i];for(const p of pref){const v=vs.find(v=>p.test(v.name));if(v)return v}return vs[0]}
function speak(text){ if(!('speechSynthesis'in window))return; const u=new SpeechSynthesisUtterance(text); const v=pickMaleVoice(); if(v)u.voice=v; u.rate=1.02; u.pitch=1.05; speechSynthesis.cancel(); speechSynthesis.speak(u) }
requestIdleCallback?.(()=>speechSynthesis.getVoices());

/* ===== journal (init lazily when visible) ===== */
const storeKey='tt_journal_v1'; let journal=null;
function ensureJournal(){ if(journal) return; journal = JSON.parse(localStorage.getItem(storeKey)||'[]'); renderJournal() }
function renderJournal(){
  const tb=$('#jTable tbody'); tb.innerHTML=''; let eq=0; const pts=[0];
  journal.forEach(r=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${new Date(r.ts).toLocaleString()}</td><td>${r.sym}</td><td align="center">${r.side}</td><td align="right" class="mono">${num(+r.entry,4)}</td><td align="right" class="mono">${num(+r.exit,4)}</td><td align="right" class="mono">${num(r.pnl,2)}</td><td>${r.notes||''}</td>`; tb.appendChild(tr); eq+=r.pnl; pts.push(eq); });
  drawEquity(pts);
}
function drawEquity(pts){ const c=$('#equity'), ctx=c.getContext('2d'); const w=c.width=c.clientWidth, h=c.height; ctx.clearRect(0,0,w,h); if(pts.length<2)return; const mx=Math.max(...pts), mn=Math.min(...pts), R=(mx-mn)||1; ctx.strokeStyle='#7c5cff'; ctx.lineWidth=2; ctx.beginPath(); pts.forEach((v,i)=>{const x=i/(pts.length-1)*w; const y=h-((v-mn)/R)*h; if(i===0)ctx.moveTo(x,y); else ctx.lineTo(x,y)}); ctx.stroke(); }
$('#addJ').onclick=()=>{ ensureJournal(); const sym=$('#jSym').value.trim()||'‚Äî', entry=parseFloat($('#jEntry').value||'0'), exit=parseFloat($('#jExit').value||'0'), side=$('#jSide').value, notes=$('#jNotes').value.trim(); if(!entry||!exit){alert('Entry & Exit required');return} const pnl=(side==='BUY')?(exit-entry):(entry-exit); journal.push({ts:Date.now(),sym: sym.toUpperCase(),entry,exit,side,notes,pnl}); localStorage.setItem(storeKey,JSON.stringify(journal)); renderJournal() };
new IntersectionObserver((es)=>{if(es[0].isIntersecting){ensureJournal();}}, {rootMargin:"200px"}).observe($('#journalCard'));

$('#openStrategies').setAttribute('aria-controls','guide'); $('#openGuide').setAttribute('aria-controls','guide'); $('#year').textContent=new Date().getFullYear();
</script>
</body>
</html>
